import base64

exec(base64.b64decode( b'ZnJvbSB0ZWxldGhvbi5zeW5jIGltcG9ydCBUZWxlZ3JhbUNsaWVudApmcm9tIHRlbGV0aG9uLnRsLnR5cGVzIGltcG9ydCBJbnB1dFBlZXJDaGFubmVsCmZyb20gdGVsZXRob24uZXJyb3JzLnJwY2Vycm9ybGlzdCBpbXBvcnQgUGVlckZsb29kRXJyb3IsIFVzZXJQcml2YWN5UmVzdHJpY3RlZEVycm9yLCBQaG9uZU51bWJlckJhbm5lZEVycm9yLCBDaGF0QWRtaW5SZXF1aXJlZEVycm9yCmZyb20gdGVsZXRob24uZXJyb3JzLnJwY2Vycm9ybGlzdCBpbXBvcnQgQ2hhdFdyaXRlRm9yYmlkZGVuRXJyb3IsIFVzZXJCYW5uZWRJbkNoYW5uZWxFcnJvciwgVXNlckFscmVhZHlQYXJ0aWNpcGFudEVycm9yLCBGbG9vZFdhaXRFcnJvcgpmcm9tIHRlbGV0aG9uLnRsLmZ1bmN0aW9ucy5jaGFubmVscyBpbXBvcnQgSW52aXRlVG9DaGFubmVsUmVxdWVzdApmcm9tIHRlbGV0aG9uLnRsLmZ1bmN0aW9ucy5tZXNzYWdlcyBpbXBvcnQgR2V0RGlhbG9nc1JlcXVlc3QKZnJvbSB0ZWxldGhvbi50bC5mdW5jdGlvbnMubWVzc2FnZXMgaW1wb3J0IFJlcG9ydFNwYW1SZXF1ZXN0CmZyb20gdGVsZXRob24udGwudHlwZXMgaW1wb3J0IElucHV0UGVlckVtcHR5CmZyb20gdGVsZXRob24udGwuZnVuY3Rpb25zLmNoYW5uZWxzIGltcG9ydCBMZWF2ZUNoYW5uZWxSZXF1ZXN0CmltcG9ydCBzeXMKZnJvbSB0ZWxldGhvbi50bC5mdW5jdGlvbnMucGhvdG9zIGltcG9ydCBVcGxvYWRQcm9maWxlUGhvdG9SZXF1ZXN0CmZyb20gdGVsZXRob24udGwuZnVuY3Rpb25zLm1lc3NhZ2VzIGltcG9ydCBJbXBvcnRDaGF0SW52aXRlUmVxdWVzdCwgQWRkQ2hhdFVzZXJSZXF1ZXN0CmZyb20gdGVsZXRob24udGwuZnVuY3Rpb25zLmNoYW5uZWxzIGltcG9ydCBKb2luQ2hhbm5lbFJlcXVlc3QKZnJvbSB0ZWxldGhvbi50bC50eXBlcyBpbXBvcnQgVXNlclN0YXR1c1JlY2VudGx5CmltcG9ydCB0aW1lCmltcG9ydCByYW5kb20KaW1wb3J0IG9zCmltcG9ydCBwaWNrbGUKZnJvbSB0ZWxldGhvbi5zeW5jIGltcG9ydCBUZWxlZ3JhbUNsaWVudApmcm9tIHRlbGV0aG9uLmVycm9ycy5ycGNlcnJvcmxpc3QgaW1wb3J0IFBob25lTnVtYmVyQmFubmVkRXJyb3IKZnJvbSBjb2xvcmFtYSBpbXBvcnQgaW5pdCwgRm9yZQpmcm9tIHRpbWUgaW1wb3J0IHNsZWVwCmltcG9ydCBjc3YKc2NhbSA9ICdAbm90b3NjYW0nCmluaXQoKQoKbiA9IEZvcmUuUkVTRVQKbGcgPSBGb3JlLkxJR0hUR1JFRU5fRVgKciA9IEZvcmUuUkVECncgPSBGb3JlLldISVRFCmN5ID0gRm9yZS5DWUFOCnllID0gRm9yZS5ZRUxMT1cKY29sb3JzID0gW2xnLCByLCB3LCBjeSwgeWVdCgp0cnk6CiAgICBpbXBvcnQgcmVxdWVzdHMKZXhjZXB0IEltcG9ydEVycm9yOgogICAgcHJpbnQoZid7bGd9W2ldIEluc3RhbGxpbmcgbW9kdWxlIC0gcmVxdWVzdHMuLi57bn0nKQogICAgb3Muc3lzdGVtKCdwaXAgaW5zdGFsbCByZXF1ZXN0cycpCgpkZWYgYmFubmVyKCk6CiAgICBpbXBvcnQgcmFuZG9tCiAgICAjIGZhbmN5IGxvZ28KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAKICAgIGI9IFsKCiAgICAgJ+KWiOKWiOKWiOKVl+KWkeKWkeKWkeKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKWiOKWiOKWiOKVl+KWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKWiOKVlycsCiAgICAgJ+KWiOKWiOKWiOKWiOKVl+KWkeKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVl+KWiOKWiOKVlOKVkOKVkOKVkOKVkOKVneKWiOKWiOKVkeKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVlycsCiAgICAgJ+KWiOKWiOKVlOKWiOKWiOKWiOKWiOKVlOKWiOKWiOKVkeKWiOKWiOKWiOKWiOKWiOKWiOKWiOKVkeKWiOKWiOKWiOKWiOKWiOKVl+KWkeKWkeKWiOKWiOKVkeKWiOKWiOKWiOKWiOKWiOKWiOKWiOKVkScsCiAgICAgJ+KWiOKWiOKVkeKVmuKWiOKWiOKVlOKVneKWiOKWiOKVkeKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVkeKWiOKWiOKVlOKVkOKVkOKVneKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVkScsCiAgICAgJ+KWiOKWiOKVkeKWkeKVmuKVkOKVneKWkeKWiOKWiOKVkeKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVkeKWkeKWkeKWkeKWkeKWkeKWiOKWiOKVkeKWiOKWiOKVkeKWkeKWkeKWiOKWiOKVkScsCiAgICAgJ+KVmuKVkOKVneKWkeKWkeKWkeKWkeKWkeKVmuKVkOKVneKVmuKVkOKVneKWkeKWkeKVmuKVkOKVneKVmuKVkOKVneKWkeKWkeKWkeKWkeKWkeKVmuKVkOKVneKVmuKVkOKVneKWkeKWkeKVmuKVkOKVnScsCgogICAgICAn4paI4paI4paI4paI4paI4pWXIOKWiOKWiOKWiOKWiOKWiOKWiOKVlyDilojilojilojilojilojilojilZcg4paI4paI4paI4paI4paI4paI4paI4pWX4paI4paI4paI4paI4paI4paI4pWXJywKICAgICAn4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4paI4paI4pWU4pWQ4pWQ4paI4paI4pWX4paI4paI4pWU4pWQ4pWQ4pWQ4pWQ4pWd4paI4paI4pWU4pWQ4pWQ4paI4paI4pWXICcsCiAgICAgJ+KWiOKWiOKWiOKWiOKWiOKWiOKWiOKVkeKWiOKWiOKVkSAg4paI4paI4pWR4paI4paI4pWRICDilojilojilZHilojilojilojilojilojilZcgIOKWiOKWiOKWiOKWiOKWiOKWiOKVlOKVnScsCiAgICAgJ+KWiOKWiOKVlOKVkOKVkOKWiOKWiOKVkeKWiOKWiOKVkSAg4paI4paI4pWR4paI4paI4pWRICDilojilojilZHilojilojilZTilZDilZDilZ0gIOKWiOKWiOKVlOKVkOKVkOKWiOKWiOKVlycsCiAgICAgJ+KWiOKWiOKVkSAg4paI4paI4pWR4paI4paI4paI4paI4paI4paI4pWU4pWd4paI4paI4paI4paI4paI4paI4pWU4pWd4paI4paI4paI4paI4paI4paI4paI4pWX4paI4paI4pWRICDilojilojilZEnLAogICAgICfilZrilZDilZ0gIOKVmuKVkOKVneKVmuKVkOKVkOKVkOKVkOKVkOKVnSDilZrilZDilZDilZDilZDilZDilZ0g4pWa4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWd4pWa4pWQ4pWdICDilZrilZDilZ0nCgogICAgXQogICAgZm9yIGNoYXIgaW4gYjoKICAgICAgICBwcmludChmJ3tjaGFyfXt3fScpCiAgICBwcmludChmJ3tyfSBBdXRob3I6IGdpdGh1Yi5jb20vdGhhbm9zdXNlcntyfScpCiAgICBwcmludChmJ3tyfSBEZXZlbG9wZXIgOiBAbWFmaWFyaXNoYWJoe3J9JykKCmRlZiBjbHIoKToKICAgIGlmIG9zLm5hbWUgPT0gJ250JzoKICAgICAgICBvcy5zeXN0ZW0oJ2NscycpCiAgICBlbHNlOgogICAgICAgIG9zLnN5c3RlbSgnY2xlYXInKQoKd2hpbGUgVHJ1ZToKICAgIGNscigpCiAgICBiYW5uZXIoKQogICAgcHJpbnQoeWUrJ0Nob29zZSBhIE9wdGlvbjonK24pCiAgICBwcmludChjeSsnICAgICAgICAgICAgWzFdIEFkZCBuZXcgYWNjb3VudHMgaW4gbWFmaWEnK24pCiAgICBwcmludChjeSsnICAgICAgICAgICAgWzJdIGNoZWNrIGFsbCBiYW5uZWQgYWNjb3VudHMnK24pCiAgICBwcmludChjeSsnICAgICAgICAgICAgWzNdIFJlbW92ZSBzcGVjaWZpYyBhY2NvdW50cycrbikKICAgIHByaW50KGN5KycgICAgICAgICAgICBbNF0gc3RhcnQgbWFmaWEnK24pCiAgICBwcmludCh5ZSsnU3BlY2lhbCBPcHRpb25zOicrbikKICAgIHByaW50KGN5KycgICAgICAgICAgICBbNV0gU2NhbSBUYWcgW1NwZWNpYWxdJytuKQogICAgcHJpbnQoY3krJyAgICAgICAgICAgIFs2XSBCdWxrIE1lc3NhZ2UgU2VuZGVyW3NwZWNpYWxdJytuKQogICAgcHJpbnQoY3krJyAgICAgICAgICAgIFs3XSBTZXQgUHJvZmlsZSBQaWMgICcrbikKICAgIHByaW50KGN5KycgICAgICAgICAgICBbOF0gUmVwb3J0IFNwYW0gQSBVc2VyJytuKQogICAgcHJpbnQoeWUrJ0FkZGl0aW9uYWwgT3B0aW9uczonK24pCiAgICBwcmludChjeSsnICAgICAgICAgICAgWzldICBTZW5kIERNIFtwbSBzcGFtXScrbikKICAgIHByaW50KGN5KycgICAgICAgICAgICBbMTFdIGpvaW4gY2hhbm5lbC9ncm91cCAnK24pCiAgICBwcmludChjeSsnICAgICAgICAgICAgWzEyXSBsZWF2ZSBjaGFubmVsL2dyb3VwJytuKQogICAgcHJpbnQoY3krJyAgICAgICAgICAgIFsxM10gVXBkYXRlIHlvdXIgbWFmaWEnK24pCgogICAgcHJpbnQoY3krJyAgICAgICAgICAgIFswXSAgRXhpdCcrbikKCgoKICAgIGEgPSBpbnQoaW5wdXQoJ1xuRW50ZXIgeW91ciBjaG9pY2U6ICcpKQogICAgaWYgYSA9PSAxOgogICAgICAgIG5ld19hY2NzID0gW10KICAgICAgICB3aXRoIG9wZW4oJ3ZhcnMudHh0JywgJ2FiJykgYXMgZzoKICAgICAgICAgICAgbnVtYmVyX3RvX2FkZCA9IGludChpbnB1dChmJ1xue2xnfSBbfl0gRW50ZXIgbnVtYmVyIG9mIGFjY291bnRzIHRvIGFkZCBpbiBtYWZpYToge3J9JykpCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKG51bWJlcl90b19hZGQpOgogICAgICAgICAgICAgICAgcGhvbmVfbnVtYmVyID0gc3RyKGlucHV0KGYnXG57bGd9IFt+XSBFbnRlciBQaG9uZSBOdW1iZXIgd2l0aCBjb3VudHJ5IGNvZGU6IHtyfScpKQogICAgICAgICAgICAgICAgcGFyc2VkX251bWJlciA9ICcnLmpvaW4ocGhvbmVfbnVtYmVyLnNwbGl0KCkpCiAgICAgICAgICAgICAgICBwaWNrbGUuZHVtcChbcGFyc2VkX251bWJlcl0sIGcpCiAgICAgICAgICAgICAgICBuZXdfYWNjcy5hcHBlbmQocGFyc2VkX251bWJlcikKICAgICAgICAgICAgcHJpbnQoZidcbntsZ30gW2ldIFNhdmVkIGFsbCBhY2NvdW50cyBpbiB2YXJzLnR4dCcpCiAgICAgICAgICAgIGNscigpCiAgICAgICAgICAgIHByaW50KGYnXG57bGd9IFsqXSBMb2dnaW5nICBuZXcgYWNjb3VudHNcbicpCiAgICAgICAgICAgIGZvciBudW1iZXIgaW4gbmV3X2FjY3M6CiAgICAgICAgICAgICAgICBjID0gVGVsZWdyYW1DbGllbnQoZidzZXNzaW9ucy97bnVtYmVyfScsIDgwMjcxOTYgLCAnOWI3MGIyMGVmZDY3ZTliOTllZGMzOTVkNzg0MDdjZmEnKQogICAgICAgICAgICAgICAgYy5zdGFydChudW1iZXIpCiAgICAgICAgICAgICAgICBwcmludChmJ3tsZ31bK10gbnVtYmVyIGFkZGVkIHN1Y2Nlc3NmdWwnKQogICAgICAgICAgICAgICAgYy5kaXNjb25uZWN0KCkKICAgICAgICAgICAgaW5wdXQoZidcbiBQcmVzcyBlbnRlciB0byBnb3RvIG1hZmlhIG1lbnUuLi4nKQoKICAgICAgICBnLmNsb3NlKCkKICAgIGVsaWYgYSA9PSAyOgogICAgICAgIGFjY291bnRzID0gW10KICAgICAgICBiYW5uZWRfYWNjcyA9IFtdCiAgICAgICAgaCA9IG9wZW4oJ3ZhcnMudHh0JywgJ3JiJykKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhY2NvdW50cy5hcHBlbmQocGlja2xlLmxvYWQoaCkpCiAgICAgICAgICAgIGV4Y2VwdCBFT0ZFcnJvcjoKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaC5jbG9zZSgpCiAgICAgICAgaWYgbGVuKGFjY291bnRzKSA9PSAwOgogICAgICAgICAgICBwcmludChyKydbIV0gVGhlcmUgYXJlIG5vIGFjY291bnRzISBQbGVhc2UgYWRkIHNvbWUgYW5kIHJldHJ5JykKICAgICAgICAgICAgc2xlZXAoMykKICAgICAgICBlbHNlOgogICAgICAgICAgICBmb3IgYWNjb3VudCBpbiBhY2NvdW50czoKICAgICAgICAgICAgICAgIHBob25lID0gc3RyKGFjY291bnRbMF0pCiAgICAgICAgICAgICAgICBjbGllbnQgPSBUZWxlZ3JhbUNsaWVudChmJ3Nlc3Npb25zL3twaG9uZX0nLCA4MDI3MTk2ICwgJzliNzBiMjBlZmQ2N2U5Yjk5ZWRjMzk1ZDc4NDA3Y2ZhJykKICAgICAgICAgICAgICAgIGNsaWVudC5jb25uZWN0KCkKICAgICAgICAgICAgICAgIGlmIG5vdCBjbGllbnQuaXNfdXNlcl9hdXRob3JpemVkKCk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBjbGllbnQuc2VuZF9jb2RlX3JlcXVlc3QocGhvbmUpCiAgICAgICAgICAgICAgICAgICAgICAgICNjbGllbnQuc2lnbl9pbihwaG9uZSwgaW5wdXQoJ1srXSBFbnRlciB0aGUgY29kZTogJykpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYne2xnfVsrXSB7cGhvbmV9IGlzIG5vdCBiYW5uZWR7bn0nKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBQaG9uZU51bWJlckJhbm5lZEVycm9yOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChyK3N0cihwaG9uZSkgKyAnIGlzIGJhbm5lZCEnK24pCiAgICAgICAgICAgICAgICAgICAgICAgIGJhbm5lZF9hY2NzLmFwcGVuZChhY2NvdW50KQogICAgICAgICAgICBpZiBsZW4oYmFubmVkX2FjY3MpID09IDA6CiAgICAgICAgICAgICAgICBwcmludChsZysnQ29uZ3JhdHMhIE5vIGJhbm5lZCBhY2NvdW50cycpCiAgICAgICAgICAgICAgICBpbnB1dCgnXG5QcmVzcyBlbnRlciB0byBnb3RvIG1hZmlhIG1lbnUuLi4nKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZm9yIG0gaW4gYmFubmVkX2FjY3M6CiAgICAgICAgICAgICAgICAgICAgYWNjb3VudHMucmVtb3ZlKG0pCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oJ3ZhcnMudHh0JywgJ3diJykgYXMgazoKICAgICAgICAgICAgICAgICAgICBmb3IgYSBpbiBhY2NvdW50czoKICAgICAgICAgICAgICAgICAgICAgICAgUGhvbmUgPSBhWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIHBpY2tsZS5kdW1wKFtQaG9uZV0sIGspCiAgICAgICAgICAgICAgICBrLmNsb3NlKCkKICAgICAgICAgICAgICAgIHByaW50KGxnKydbaV0gQWxsIGJhbm5lZCBhY2NvdW50cyByZW1vdmVkJytuKQogICAgICAgICAgICAgICAgaW5wdXQoJ1xuUHJlc3MgZW50ZXIgdG8gZ290byBtYWZpYSBtZW51Li4uJykKCiAgICBlbGlmIGEgPT0gMzoKICAgICAgICBhY2NzID0gW10KICAgICAgICBmID0gb3BlbigndmFycy50eHQnLCAncmInKQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFjY3MuYXBwZW5kKHBpY2tsZS5sb2FkKGYpKQogICAgICAgICAgICBleGNlcHQgRU9GRXJyb3I6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGYuY2xvc2UoKQogICAgICAgIGkgPSAwCiAgICAgICAgcHJpbnQoZid7bGd9W2ldIENob29zZSBhbiBhY2NvdW50IHRvIGRlbGV0ZVxuJykKICAgICAgICBmb3IgYWNjIGluIGFjY3M6CiAgICAgICAgICAgIHByaW50KGYne2xnfVt7aX1dIHthY2NbMF19e259JykKICAgICAgICAgICAgaSArPSAxCiAgICAgICAgaW5kZXggPSBpbnQoaW5wdXQoZidcbntsZ31bK10gRW50ZXIgYSBjaG9pY2U6IHtufScpKQogICAgICAgIHBob25lID0gc3RyKGFjY3NbaW5kZXhdWzBdKQogICAgICAgIHNlc3Npb25fZmlsZSA9IHBob25lICsgJy5zZXNzaW9uJwogICAgICAgIGlmIG9zLm5hbWUgPT0gJ250JzoKICAgICAgICAgICAgb3Muc3lzdGVtKGYnZGVsIHNlc3Npb25zXFx7c2Vzc2lvbl9maWxlfScpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgb3Muc3lzdGVtKGYncm0gc2Vzc2lvbnMve3Nlc3Npb25fZmlsZX0nKQogICAgICAgIGRlbCBhY2NzW2luZGV4XQogICAgICAgIGYgPSBvcGVuKCd2YXJzLnR4dCcsICd3YicpCiAgICAgICAgZm9yIGFjY291bnQgaW4gYWNjczoKICAgICAgICAgICAgcGlja2xlLmR1bXAoYWNjb3VudCwgZikKICAgICAgICBwcmludChmJ1xue2xnfVsrXSBBY2NvdW50IERlbGV0ZWR7bn0nKQogICAgICAgIGlucHV0KGYnXG5QcmVzcyBlbnRlciB0byBnb3RvIG1hZmlhIG1lbnUuLi4nKQogICAgICAgIGYuY2xvc2UoKQogICAgZWxpZiBhID09IDQ6CiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIGYgPSBvcGVuKCd2YXJzLnR4dCcsICdyYicpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKHBpY2tsZS5sb2FkKGYpKQogICAgICAgICAgICBleGNlcHQgRU9GRXJyb3I6CiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAKICAgICAgICAjcHJpbnQoJ1xuJyArIGluZm8gKyBsZyArICcgbWFmaWEgc3RhcnRpbmcgd2FpdC4uLicgKyBycykKICAgICAgICBwcmludCgnXG4nICcgbWFmaWEgc3RhcnRpbmcgd2FpdC4uLicgKQogICAgICAgIGZvciBhIGluIGFjY291bnRzOgogICAgICAgICAgICBwaG4gPSBhWzBdCiAgICAgICAgICAgIHByaW50KGYnQ2hlY2tpbmcge2xnfXtwaG59JykKICAgICAgICAgICAgY2xudCA9IFRlbGVncmFtQ2xpZW50KGYnc2Vzc2lvbnMve3Bobn0nLCA4MDI3MTk2ICwgJzliNzBiMjBlZmQ2N2U5Yjk5ZWRjMzk1ZDc4NDA3Y2ZhJykKICAgICAgICAgICAgY2xudC5jb25uZWN0KCkKICAgICAgICAgICAgYmFubmVkID0gW10KICAgICAgICAgICAgaWYgbm90IGNsbnQuaXNfdXNlcl9hdXRob3JpemVkKCk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY2xudC5zZW5kX2NvZGVfcmVxdWVzdChwaG4pCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoJ2trJykKICAgICAgICAgICAgICAgIGV4Y2VwdCBQaG9uZU51bWJlckJhbm5lZEVycm9yOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYne3d9e3Bobn0ge3J9aXMgYmFubmVkIXtyc30nKQogICAgICAgICAgICAgICAgICAgIGJhbm5lZC5hcHBlbmQoYSkKICAgICAgICAgICAgZm9yIHogaW4gYmFubmVkOgogICAgICAgICAgICAgICAgYWNjb3VudHMucmVtb3ZlKHopCiAgICAgICAgICAgICAgICBwcmludCgne2xnfUJhbm5lZCBhY2NvdW50IHJlbW92ZWRbUmVtb3ZlIHBlcm1hbmVudGx5IHVzaW5nIG1haW4ucHlde3JzfScpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICBjbG50LmRpc2Nvbm5lY3QoKQogICAgICAgIHByaW50KCcgU2Vzc2lvbnMgY3JlYXRlZCEnKQogICAgICAgIGNscigpCiAgICAgICAgYmFubmVyKCkKIyBmdW5jIHRvIGxvZyBzY3JhcGluZyBkZXRhaWxzKGxpbmsgb2YgdGhlIGdycCB0byBzY3JhcGUKIyBhbmQgY3VycmVudCBpbmRleCkgaW4gb3JkZXIgdG8gcmVzdW1lIGxhdGVyCiAgICAgICAgZGVmIGxvZ19zdGF0dXMoc2NyYXBlZCwgaW5kZXgpOgogICAgICAgICAgICB3aXRoIG9wZW4oJ3N0YXR1cy5kYXQnLCAnd2InKSBhcyBmOgogICAgICAgICAgICAgICAgcGlja2xlLmR1bXAoW3NjcmFwZWQsIGludChpbmRleCldLCBmKQogICAgICAgICAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgICAgIHByaW50KGYne2xnfSBTZXNzaW9uIHN0b3JlZCBpbiB7d31zdGF0dXMuZGF0e2xnfScpCiAgICAKCiAgICAgICAgZGVmIGV4aXRfd2luZG93KCk6CiAgICAgICAgICAgIGlucHV0KGYnXG57Y3l9IFByZXNzIGVudGVyIHRvIGV4aXQuLi4nKQogICAgICAgICAgICBjbHIoKQogICAgICAgICAgICBiYW5uZXIoKQogICAgICAgICAgICBzeXMuZXhpdCgpCiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIG9wZW4oJ3N0YXR1cy5kYXQnLCAncmInKSBhcyBmOgogICAgICAgICAgICAgICAgc3RhdHVzID0gcGlja2xlLmxvYWQoZikKICAgICAgICAgICAgICAgIGYuY2xvc2UoKQogICAgICAgICAgICAgICAgbG9sID0gaW5wdXQoZid7Y3l9IFJlc3VtZSBzY3JhcGluZyBtZW1iZXJzIGZyb20ge3d9e3N0YXR1c1swXX17bGd9PyBbeS9uXToge3J9JykKICAgICAgICAgICAgICAgIGlmICd5JyBpbiBsb2w6CiAgICAgICAgICAgICAgICAgICAgc2NyYXBlZF9ncnAgPSBzdGF0dXNbMF0gOyBpbmRleCA9IGludChzdGF0dXNbMV0pCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIG9zLm5hbWUgPT0gJ250JzoKICAgICAgICAgICAgICAgICAgICAgICAgb3Muc3lzdGVtKCdkZWwgc3RhdHVzLmRhdCcpCiAgICAgICAgICAgICAgICAgICAgZWxzZTogCiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnN5c3RlbSgncm0gc3RhdHVzLmRhdCcpCiAgICAgICAgICAgICAgICAgICAgc2NyYXBlZF9ncnAgPSBpbnB1dChmJ3tjeX0gUHVibGljL1ByaXZhdGUgZ3JvdXAgbGluayB0byBzY3JhcGUgbWVtYmVyczoge3J9JykKICAgICAgICAgICAgICAgICAgICBpbmRleCA9IDAKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHNjcmFwZWRfZ3JwID0gaW5wdXQoZid7Y3l9IFB1YmxpYy9Qcml2YXRlIGdyb3VwIGxpbmsgdG8gc2NyYXBlIG1lbWJlcnM6IHtyfScpCiAgICAgICAgICAgIGluZGV4ID0gMAojIGxvYWQgYWxsIHRoZSBhY2NvdW50cyhwaG9uZW51bWJlcnMpCiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIGYgPSBvcGVuKCd2YXJzLnR4dCcsICdyYicpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKHBpY2tsZS5sb2FkKGYpKQogICAgICAgICAgICBleGNlcHQgRU9GRXJyb3I6CiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICBwcmludChmJ3tsZ30gVG90YWwgYWNjb3VudHM6IHt3fXtsZW4oYWNjb3VudHMpfScpCiAgICAgICAgbnVtYmVyX29mX2FjY3MgPSBpbnQoaW5wdXQoZid7Y3l9IEVudGVyIG51bWJlciBvZiBhY2NvdW50cyB0byB1c2U6IHtyfScpKQogICAgICAgIHByaW50KGYne2N5fSBDaG9vc2UgYW4gb3B0aW9ue2xnfScpCiAgICAgICAgcHJpbnQoZid7Y3l9WzBde2xnfSBBZGQgdG8gcHVibGljIGdyb3VwJykKICAgICAgICBwcmludChmJ3tjeX1bMV17bGd9IEFkZCB0byBwcml2YXRlIGdyb3VwJykKICAgICAgICBjaG9pY2UgPSBpbnQoaW5wdXQoZid7Y3l9IEVudGVyIGNob2ljZToge3J9JykpCiAgICAgICAgaWYgY2hvaWNlID09IDA6CiAgICAgICAgICAgIHRhcmdldCA9IHN0cihpbnB1dChmJ3tjeX0gRW50ZXIgcHVibGljIGdyb3VwIGxpbms6IHtyfScpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRhcmdldCA9IHN0cihpbnB1dChmJ3tjeX0gRW50ZXIgcHJpdmF0ZSBncm91cCBsaW5rOiB7cn0nKSkKCiAgICAgICAgcHJpbnQoZidfJyo1MCkKICAgICAgICBzdGF0dXNfY2hvaWNlID0gc3RyKGlucHV0KGYne2N5fSBEbyB5b3Ugd2FubmEgYWRkIGFjdGl2ZSBtZW1iZXJzP1t5L25dOiB7cn0nKSkKICAgICAgICB0b191c2UgPSBbeCBmb3IgeCBpbiBhY2NvdW50c1s6bnVtYmVyX29mX2FjY3NdXQogICAgICAgIGZvciBsIGluIHRvX3VzZTogYWNjb3VudHMucmVtb3ZlKGwpCiAgICAgICAgd2l0aCBvcGVuKCd2YXJzLnR4dCcsICd3YicpIGFzIGY6CiAgICAgICAgICAgIGZvciBhIGluIGFjY291bnRzOgogICAgICAgICAgICAgICAgcGlja2xlLmR1bXAoYSwgZikKICAgICAgICAgICAgZm9yIGFiIGluIHRvX3VzZToKICAgICAgICAgICAgICAgIHBpY2tsZS5kdW1wKGFiLCBmKQogICAgICAgICAgICBmLmNsb3NlKCkKICAgICAgICBzbGVlcF90aW1lID0gaW50KGlucHV0KGYne2N5fSBFbnRlciBkZWxheSB0aW1lIHBlciByZXF1ZXN0e3d9W3tsZ30wIGZvciBOb25le3d9XToge3J9JykpCiAgICAgICAgcHJpbnQoZid7bGd9IEpvaW5pbmcgZ3JvdXAgZnJvbSB7d317bnVtYmVyX29mX2FjY3N9IGFjY291bnRzLi4uJykKICAgICAgICBwcmludChmJy0nKjUwKQogICAgICAgIHByaW50KGYne2xnfSAtLSBBZGRpbmcgbWVtYmVycyBmcm9tIHt3fXtsZW4odG9fdXNlKX17bGd9IGFjY291bnQocykgLS0nKQogICAgICAgIGFkZGluZ19zdGF0dXMgPSAwCiAgICAgICAgYXBwcm94X21lbWJlcnNfY291bnQgPSAwCiAgICAgICAgZm9yIGFjYyBpbiB0b191c2U6CiAgICAgICAgICAgIHN0b3AgPSBpbmRleCArIDYwCiAgICAgICAgICAgIGMgPSBUZWxlZ3JhbUNsaWVudChmJ3Nlc3Npb25zL3thY2NbMF19JywgODAyNzE5NiAsICc5YjcwYjIwZWZkNjdlOWI5OWVkYzM5NWQ3ODQwN2NmYScpCiAgICAgICAgICAgIHByaW50KGYnIFVzZXI6IHtjeX17YWNjWzBdfXtsZ30gLS0ge2N5fVN0YXJ0aW5nIHNlc3Npb24uLi4gJykKICAgICAgICAgICAgYy5zdGFydChhY2NbMF0pCiAgICAgICAgICAgIGFjY19uYW1lID0gYy5nZXRfbWUoKS5maXJzdF9uYW1lCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmICcvam9pbmNoYXQvJyBpbiBzY3JhcGVkX2dycDoKICAgICAgICAgICAgICAgICAgICBnX2hhc2ggPSBzY3JhcGVkX2dycC5zcGxpdCgnL2pvaW5jaGF0LycpWzFdCgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgYyhJbXBvcnRDaGF0SW52aXRlUmVxdWVzdChnX2hhc2gpKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmJ1VzZXI6IHtjeX17YWNjX25hbWV9e2xnfSAtLSBtYWZpYSBKb2luZWQgZ3JvdXAgdG8gc2NyYXBlJykKICAgICAgICAgICAgICAgICAgICBleGNlcHQgVXNlckFscmVhZHlQYXJ0aWNpcGFudEVycm9yOgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzIAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBjKEpvaW5DaGFubmVsUmVxdWVzdChzY3JhcGVkX2dycCkpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZidVc2VyOiB7Y3l9e2FjY19uYW1lfXtsZ30gLS0gbWFmaWEgSm9pbmVkIGdyb3VwIHRvIHNjcmFwZScpCiAgICAgICAgICAgICAgICBzY3JhcGVkX2dycF9lbnRpdHkgPSBjLmdldF9lbnRpdHkoc2NyYXBlZF9ncnApCiAgICAgICAgICAgICAgICBpZiBjaG9pY2UgPT0gMDoKICAgICAgICAgICAgICAgICAgICBjKEpvaW5DaGFubmVsUmVxdWVzdCh0YXJnZXQpKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYnVXNlcjoge2N5fXthY2NfbmFtZX17bGd9IC0tIG1hZmlhIEpvaW5lZCBncm91cCB0byBhZGQnKQogICAgICAgICAgICAgICAgICAgIHRhcmdldF9lbnRpdHkgPSBjLmdldF9lbnRpdHkodGFyZ2V0KQogICAgICAgICAgICAgICAgICAgIHRhcmdldF9kZXRhaWxzID0gSW5wdXRQZWVyQ2hhbm5lbCh0YXJnZXRfZW50aXR5LmlkLCB0YXJnZXRfZW50aXR5LmFjY2Vzc19oYXNoKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGdycF9oYXNoID0gdGFyZ2V0LnNwbGl0KCcvam9pbmNoYXQvJylbMV0KICAgICAgICAgICAgICAgICAgICAgICAgYyhJbXBvcnRDaGF0SW52aXRlUmVxdWVzdChncnBfaGFzaCkpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYnVXNlcjoge2N5fXthY2NfbmFtZX17bGd9IC0tIG1hZmlhIEpvaW5lZCBncm91cCB0byBhZGQnKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBVc2VyQWxyZWFkeVBhcnRpY2lwYW50RXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgICAgICB0YXJnZXRfZW50aXR5ID0gYy5nZXRfZW50aXR5KHRhcmdldCkKICAgICAgICAgICAgICAgICAgICB0YXJnZXRfZGV0YWlscyA9IHRhcmdldF9lbnRpdHkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZidVc2VyOiB7Y3l9e2FjY19uYW1lfXtsZ30gLS0gRmFpbGVkIHRvIGpvaW4gZ3JvdXAnKQogICAgICAgICAgICAgICAgcHJpbnQoZid7ZX0nKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgcHJpbnQoZicgVXNlcjoge2N5fXthY2NfbmFtZX17bGd9IC0tIHtjeX1SZXRyaWV2aW5nIGVudGl0aWVzLi4uJykKICAgICNjLmdldF9kaWFsb2dzKCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbWVtYmVycyA9IFtdCiAgICAgICAgICAgICAgICBtZW1iZXJzID0gYy5nZXRfcGFydGljaXBhbnRzKHNjcmFwZWRfZ3JwX2VudGl0eSxhZ2dyZXNzaXZlPUZhbHNlKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmJyBDb3VsZG5cJ3Qgc2NyYXBlIG1lbWJlcnMnKQogICAgICAgICAgICAgICAgcHJpbnQoZid7ZX0nKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgYXBwcm94X21lbWJlcnNfY291bnQgPSBsZW4obWVtYmVycykKICAgICAgICAgICAgYXNzZXJ0IGFwcHJveF9tZW1iZXJzX2NvdW50ICE9IDAKICAgICAgICAgICAgaWYgaW5kZXggPj0gYXBwcm94X21lbWJlcnNfY291bnQ6CiAgICAgICAgICAgICAgICBwcmludChmJ3tsZ30gTm8gbWVtYmVycyB0byBhZGQhJykKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHByaW50KGYne2xnfSBTdGFydDoge3d9e2luZGV4fScpCiAgICAjYWRkaW5nX3N0YXR1cyA9IDAKICAgICAgICAgICAgcGVlcl9mbG9vZF9zdGF0dXMgPSAwCiAgICAgICAgICAgIGZvciB1c2VyIGluIG1lbWJlcnNbaW5kZXg6c3RvcF06CiAgICAgICAgICAgICAgICBpbmRleCArPSAxCiAgICAgICAgICAgICAgICBpZiBwZWVyX2Zsb29kX3N0YXR1cyA9PSAxMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmJ1RvbyBtYW55IFBlZXIgRmxvb2QgRXJyb3JzISBDbG9zaW5nIHNlc3Npb24uLi4nKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgY2hvaWNlID09IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGMoSW52aXRlVG9DaGFubmVsUmVxdWVzdCh0YXJnZXRfZGV0YWlscywgW3VzZXJdKSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBjKEFkZENoYXRVc2VyUmVxdWVzdCh0YXJnZXRfZGV0YWlscy5pZCwgdXNlciwgNDIpKQogICAgICAgICAgICAgICAgICAgIHVzZXJfaWQgPSB1c2VyLmZpcnN0X25hbWUKICAgICAgICAgICAgICAgICAgICB0YXJnZXRfdGl0bGUgPSB0YXJnZXRfZW50aXR5LnRpdGxlCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZidVc2VyOiB7Y3l9e2FjY19uYW1lfXtsZ30gPT0+IHtjeX17dXNlcl9pZH0ge2xnfT09PiB7Y3l9e3RhcmdldF90aXRsZX0nKQogICAgICAgICAgICAgICAgICAgICNwcmludChmJ1VzZXI6IHtjeX17YWNjX25hbWV9e2xnfSAtLSBTbGVlcCAxIHNlY29uZCcpCiAgICAgICAgICAgICAgICAgICAgYWRkaW5nX3N0YXR1cyArPSAxCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZidVc2VyOiB7Y3l9e2FjY19uYW1lfXtsZ30gLS0gU2xlZXAge3d9e3NsZWVwX3RpbWV9IHtsZ31zZWNvbmQocyknKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoc2xlZXBfdGltZSkKICAgICAgICAgICAgICAgIGV4Y2VwdCBVc2VyUHJpdmFjeVJlc3RyaWN0ZWRFcnJvcjoKICAgICAgICAgICAgICAgICAgICBwcmludChmJ1VzZXI6IHtjeX17YWNjX25hbWV9e2xnfSAtLSB7cn1Vc2VyIFByaXZhY3kgUmVzdHJpY3RlZCBFcnJvcicpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIGV4Y2VwdCBQZWVyRmxvb2RFcnJvcjoKICAgICAgICAgICAgICAgICAgICBwcmludChmJ1VzZXI6IHtjeX17YWNjX25hbWV9e2xnfSAtLSB7cn1QZWVyIEZsb29kIEVycm9yLicpCiAgICAgICAgICAgICAgICAgICAgcGVlcl9mbG9vZF9zdGF0dXMgKz0gMQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBleGNlcHQgQ2hhdFdyaXRlRm9yYmlkZGVuRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZidDYW5cJ3QgYWRkIHRvIGdyb3VwLiBDb250YWN0IGdyb3VwIGFkbWluIHRvIGVuYWJsZSBtZW1iZXJzIGFkZGluZycpCiAgICAgICAgICAgICAgICAgICAgaWYgaW5kZXggPCBhcHByb3hfbWVtYmVyc19jb3VudDoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nX3N0YXR1cyhzY3JhcGVkX2dycCwgaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4aXRfd2luZG93KCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBVc2VyQmFubmVkSW5DaGFubmVsRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZidVc2VyOiB7Y3l9e2FjY19uYW1lfXtsZ30gLS0ge3J9QmFubmVkIGZyb20gd3JpdGluZyBpbiBncm91cHMnKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBleGNlcHQgQ2hhdEFkbWluUmVxdWlyZWRFcnJvcjoKICAgICAgICAgICAgICAgICAgICBwcmludChmJ1VzZXI6IHtjeX17YWNjX25hbWV9e2xnfSAtLSB7cn1DaGF0IEFkbWluIHJpZ2h0cyBuZWVkZWQgdG8gYWRkJykKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZXhjZXB0IFVzZXJBbHJlYWR5UGFydGljaXBhbnRFcnJvcjoKICAgICAgICAgICAgICAgICAgICBwcmludChmJ1VzZXI6IHtjeX17YWNjX25hbWV9e2xnfSAtLSB7cn1Vc2VyIGlzIGFscmVhZHkgYSBwYXJ0aWNpcGFudCcpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIGV4Y2VwdCBGbG9vZFdhaXRFcnJvciBhcyBlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYne2V9JykKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZidFcnJvciBpbiBFbnRpdHknKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZictLS0tIEFkZGluZyBUZXJtaW5hdGVkIC0tLS0nKQogICAgICAgICAgICAgICAgICAgIGlmIGluZGV4IDwgbGVuKG1lbWJlcnMpOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dfc3RhdHVzKHNjcmFwZWRfZ3JwLCBpbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgZXhpdF93aW5kb3coKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYne2V9JykKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQojZ2xvYmFsIGFkZGluZ19zdGF0dXMsIGFwcHJveF9tZW1iZXJzX2NvdW50CiAgICAgICAgaWYgYWRkaW5nX3N0YXR1cyAhPSAwOgogICAgICAgICAgICBwcmludChmIlxue2xnfSBBZGRpbmcgc2Vzc2lvbiBlbmRlZCIpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGluZGV4IDwgYXBwcm94X21lbWJlcnNfY291bnQ6CiAgICAgICAgICAgICAgICAgICAgbG9nX3N0YXR1cyhzY3JhcGVkX2dycCwgaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgZXhpdF93aW5kb3coKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBleGl0X3dpbmRvdygpCiAgICBlbGlmIGEgPT0gNToKICAgICAgICBhY2NvdW50cyA9IFtdCiAgICAgICAgZiA9IG9wZW4oJ3ZhcnMudHh0JywgJ3JiJykKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhY2NvdW50cy5hcHBlbmQocGlja2xlLmxvYWQoZikpCiAgICAgICAgICAgIGV4Y2VwdCBFT0ZFcnJvcjoKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIAogICAgICAgICNwcmludCgnXG4nICsgaW5mbyArIGxnICsgJyBDaGVja2luZyBmb3IgYmFubmVkIGFjY291bnRzLi4uJyArIHJzKQogICAgICAgIHByaW50KCdcbicgJyBDaGVja2luZyBmb3IgYmFubmVkIGFjY291bnRzLi4uJyApCiAgICAgICAgZm9yIGEgaW4gYWNjb3VudHM6CiAgICAgICAgICAgIHBobiA9IGFbMF0KICAgICAgICAgICAgcHJpbnQoZidDaGVja2luZyB7bGd9e3Bobn0nKQogICAgICAgICAgICBjbG50ID0gVGVsZWdyYW1DbGllbnQoZidzZXNzaW9ucy97cGhufScsIDgwMjcxOTYgLCAnOWI3MGIyMGVmZDY3ZTliOTllZGMzOTVkNzg0MDdjZmEnKQogICAgICAgICAgICBjbG50LmNvbm5lY3QoKQogICAgICAgICAgICBiYW5uZWQgPSBbXQogICAgICAgICAgICBpZiBub3QgY2xudC5pc191c2VyX2F1dGhvcml6ZWQoKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjbG50LnNlbmRfY29kZV9yZXF1ZXN0KHBobikKICAgICAgICAgICAgICAgICAgICBwcmludCgna2snKQogICAgICAgICAgICAgICAgZXhjZXB0IFBob25lTnVtYmVyQmFubmVkRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZid7ZXJyb3J9IHt3fXtwaG59IHtyfWlzIGJhbm5lZCF7cnN9JykKICAgICAgICAgICAgICAgICAgICBiYW5uZWQuYXBwZW5kKGEpCiAgICAgICAgICAgIGZvciB6IGluIGJhbm5lZDoKICAgICAgICAgICAgICAgIGFjY291bnRzLnJlbW92ZSh6KQogICAgICAgICAgICAgICAgcHJpbnQoJ3tsZ31CYW5uZWQgYWNjb3VudCByZW1vdmVkW1JlbW92ZSBwZXJtYW5lbnRseSB1c2luZyBtYWluLnB5XXtyc30nKQogICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkKICAgICAgICAgICAgY2xudC5kaXNjb25uZWN0KCkKICAgICAgICBwcmludCgnIFNlc3Npb25zIGNyZWF0ZWQhJykKICAgICAgICBjbHIoKQogICAgICAgIGJhbm5lcigpCiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIGYgPSBvcGVuKCd2YXJzLnR4dCcsICdyYicpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKHBpY2tsZS5sb2FkKGYpKQogICAgICAgICAgICBleGNlcHQgRU9GRXJyb3I6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIHByaW50KGYne2xnfSBUb3RhbCBhY2NvdW50czoge3d9e2xlbihhY2NvdW50cyl9JykKICAgICAgICBudW1iZXJfb2ZfYWNjcyA9IGludChpbnB1dChmJ3tjeX0gRW50ZXIgbnVtYmVyIG9mIGFjY291bnRzIHRvIFJlcG9ydDoge3J9JykpCiAgICAgICAgY2hvaWNlID0gc3RyKGlucHV0KGYne2N5fSBTZW5kIE1lc3NhZ2UgRm9yIFJlcG9ydCB7cn0nKSkKICAgICAgICB0b191c2UgPSBbeCBmb3IgeCBpbiBhY2NvdW50c1s6bnVtYmVyX29mX2FjY3NdXQogICAgICAgIGZvciBsIGluIHRvX3VzZTogYWNjb3VudHMucmVtb3ZlKGwpCiAgICAgICAgd2l0aCBvcGVuKCd2YXJzLnR4dCcsICd3YicpIGFzIGY6CiAgICAgICAgICAgIGZvciBhIGluIGFjY291bnRzOgogICAgICAgICAgICAgICAgcGlja2xlLmR1bXAoYSwgZikKICAgICAgICAgICAgZm9yIGFiIGluIHRvX3VzZToKICAgICAgICAgICAgICAgIHBpY2tsZS5kdW1wKGFiLCBmKQogICAgICAgICAgICBmLmNsb3NlKCkKICAgICAgICBzbGVlcF90aW1lID0gMQogICAgICAgIHByaW50KGYne2xnfSAtLSBTZW5kaW5nIFJlcG9ydHMgZnJvbSB7d317bGVuKHRvX3VzZSl9e2xnfSBhY2NvdW50KHMpIC0tJykgICAKICAgICAgICBzZW5kX3N0YXR1cyA9IDAKICAgICAgICAKICAgICAgICBhcHByb3hfbWVtYmVyc19jb3VudCA9IDAKICAgICAgICBpbmRleCA9IDAKICAgICAgICBmb3IgYWNjIGluIHRvX3VzZToKICAgICAgICAgICAgc3RvcCA9IGluZGV4ICsgNjAKICAgICAgICAgICAgYyA9IFRlbGVncmFtQ2xpZW50KGYnc2Vzc2lvbnMve2FjY1swXX0nLCAzOTEwMzg5ICwgJzg2Zjg2MTM1MmYwYWI3NmEyNTE4NjYwNTlhNmFkYmQ2JykKICAgICAgICAgICAgcHJpbnQoZidVc2VyOiB7Y3l9e2FjY1swXX17bGd9IC0tIHtjeX1TdGFydGluZyBzZXNzaW9uLi4uICcpCiAgICAgICAgICAgIGMuc3RhcnQoYWNjWzBdKQogICAgICAgICAgICBhY2NfbmFtZSA9IGMuZ2V0X21lKCkuZmlyc3RfbmFtZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjKEpvaW5DaGFubmVsUmVxdWVzdCgnQEJlYXN0X1NlbGxpbmcnKSkgCiAgICAgICAgICAgICAgICBjLnNlbmRfbWVzc2FnZShzY2FtLGNob2ljZSkKICAgICAgICAgICAgICAgIHByaW50KGYnUmVwb3J0IERvbmUgRnJvbToge2N5fXthY2NfbmFtZX17bGd9ICBUbyBOb3Rvc2NhbS0tICcpCiAgICAgICAgICAgICAgICBzZW5kX3N0YXR1cyArPSAxCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYne2V9JykKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgaWYgc2VuZF9zdGF0dXMgIT0gMDoKICAgICAgICAgICAgcHJpbnQoZiJcbntsZ31zZXNzaW9uIGVuZGVkIikKICAgICAgICAgICAgaW5wdXQoZidcbntjeX0gUHJlc3MgZW50ZXIgdG8gZXhpdC4uLicpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJcbntsZ31BbGwgcmVwb3J0cyBkb25lIHN1Y2VzZnVsbHkiKQogICAgICAgICAgICBpbnB1dChmJ1xue2N5fSBQcmVzcyBlbnRlciB0byBleGl0Li4uJykKCiAgICBlbGlmIGEgPT0gNjoKICAgICAgICBhY2NvdW50cyA9IFtdCiAgICAgICAgY2hhdHMgPSBbXQogICAgICAgIGxhc3RfZGF0ZSA9IE5vbmUKICAgICAgICBjaHVua19zaXplID0gMjAwCiAgICAgICAgZ3JvdXBzID0gW10KICAgICAgICBmID0gb3BlbigndmFycy50eHQnLCAncmInKQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFjY291bnRzLmFwcGVuZChwaWNrbGUubG9hZChmKSkKICAgICAgICAgICAgZXhjZXB0IEVPRkVycm9yOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBwcmludCgnXG4nICcgQ2hlY2tpbmcgZm9yIGJhbm5lZCBhY2NvdW50cy4uLicgKQogICAgICAgIGZvciBhIGluIGFjY291bnRzOgogICAgICAgICAgICBwaG4gPSBhWzBdCiAgICAgICAgICAgIHByaW50KGYnQ2hlY2tpbmcge2xnfXtwaG59JykKICAgICAgICAgICAgY2xudCA9IFRlbGVncmFtQ2xpZW50KGYnc2Vzc2lvbnMve3Bobn0nLCA4MDI3MTk2ICwgJzliNzBiMjBlZmQ2N2U5Yjk5ZWRjMzk1ZDc4NDA3Y2ZhJykKICAgICAgICAgICAgY2xudC5jb25uZWN0KCkKICAgICAgICAgICAgYmFubmVkID0gW10KICAgICAgICAgICAgaWYgbm90IGNsbnQuaXNfdXNlcl9hdXRob3JpemVkKCk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY2xudC5zZW5kX2NvZGVfcmVxdWVzdChwaG4pCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoJ2trJykKICAgICAgICAgICAgICAgIGV4Y2VwdCBQaG9uZU51bWJlckJhbm5lZEVycm9yOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYne2Vycm9yfSB7d317cGhufSB7cn1pcyBiYW5uZWQhe3JzfScpCiAgICAgICAgICAgICAgICAgICAgYmFubmVkLmFwcGVuZChhKQogICAgICAgICAgICBmb3IgeiBpbiBiYW5uZWQ6CiAgICAgICAgICAgICAgICBhY2NvdW50cy5yZW1vdmUoeikKICAgICAgICAgICAgICAgIHByaW50KCd7bGd9QmFubmVkIGFjY291bnQgcmVtb3ZlZFtSZW1vdmUgcGVybWFuZW50bHkgdXNpbmcgbWFuYWdlci5weV17cnN9JykKICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgIyBjbG50LmRpc2Nvbm5lY3QoKQogICAgICAgIHByaW50KCcgU2Vzc2lvbnMgY3JlYXRlZCEnKQogICAgICAgIGNscigpCiAgICAgICAgYmFubmVyKCkKICAgICAgICByZXN1bHQgPSBjbG50KEdldERpYWxvZ3NSZXF1ZXN0KAogICAgICAgIG9mZnNldF9kYXRlPWxhc3RfZGF0ZSwKICAgICAgICBvZmZzZXRfaWQ9MCwKICAgICAgICBvZmZzZXRfcGVlcj1JbnB1dFBlZXJFbXB0eSgpLAogICAgICAgIGxpbWl0PWNodW5rX3NpemUsCiAgICAgICAgaGFzaD0wCiAgICAgICAgKSkKICAgICAgICBjaGF0cy5leHRlbmQocmVzdWx0LmNoYXRzKQogICAgICAgIGZvciBjaGF0IGluIGNoYXRzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBjaGF0Lm1lZ2Fncm91cCA9PSBUcnVlOgogICAgICAgICAgICAgICAgICAgIGdyb3Vwcy5hcHBlbmQoY2hhdCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBhY2NfbmFtZSA9IGNsbnQuZ2V0X21lKCkuZmlyc3RfbmFtZSAKCiAgICAgICAgcHJpbnQoZidNZXNzYWdlIHdhcyBzZW5kaW5nIHRocm91aCB7YWNjX25hbWV9IHt5ZX0nKQogICAgICAgIHByaW50KGYnTWVzc2FnZSB3YXMgc2VuZGluZyB0aHJvdWgge2FjY19uYW1lfSB7eWV9JykKICAgICAgICBwcmludChmJ0Nob29zZSBhIGdyb3VwIHRvIHNjcmFwZSBtZW1iZXJzIGZyb206e2xnfScpCiAgICAgICAgaSA9IDAKICAgICAgICBmb3IgZyBpbiBncm91cHM6CiAgICAgICAgICAgIHByaW50KHN0cihpKSArICctICcgKyBnLnRpdGxlKQogICAgICAgICAgICBpICs9IDEKICAgICAgICBnX2luZGV4ID0gaW5wdXQoZiJFbnRlciBhIE51bWJlcjp7bGd9IikKICAgICAgICB0YXJnZXRfZ3JvdXAgPSBncm91cHNbaW50KGdfaW5kZXgpXQogICAgICAgIHByaW50KCdGZXRjaGluZyBNZW1iZXJzLi4uJykKICAgICAgICBhbGxfcGFydGljaXBhbnRzID0gW10KICAgICAgIAogICAgICAgIGFsbF9wYXJ0aWNpcGFudHMgPSBjbG50LmdldF9wYXJ0aWNpcGFudHModGFyZ2V0X2dyb3VwLCBhZ2dyZXNzaXZlPVRydWUpCiAgICAgICAgCiAgICAgICAgcHJpbnQoJ1NhdmluZyBJbiBmaWxlLi4uJykKICAgICAgICB3aXRoIG9wZW4oIm1lbWJlcnMuY3N2IiwgInciLCBlbmNvZGluZz0nVVRGLTgnKSBhcyBmOgogICAgICAgICAgICB3cml0ZXIgPSBjc3Yud3JpdGVyKGYsIGRlbGltaXRlcj0iLCIsIGxpbmV0ZXJtaW5hdG9yPSJcbiIpCiAgICAgICAgICAgIHdyaXRlci53cml0ZXJvdyhbJ3VzZXJuYW1lJywgJ3VzZXIgaWQnLCAnYWNjZXNzIGhhc2gnLCAnbmFtZScsICdncm91cCcsICdncm91cCBpZCddKQogICAgICAgICAgICBmb3IgdXNlciBpbiBhbGxfcGFydGljaXBhbnRzOgogICAgICAgICAgICAgICAgaWYgdXNlci51c2VybmFtZToKICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHVzZXIudXNlcm5hbWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgPSAiIgogICAgICAgICAgICAgICAgaWYgdXNlci5maXJzdF9uYW1lOgogICAgICAgICAgICAgICAgICAgIGZpcnN0X25hbWUgPSB1c2VyLmZpcnN0X25hbWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmlyc3RfbmFtZSA9ICIiCiAgICAgICAgICAgICAgICBpZiB1c2VyLmxhc3RfbmFtZToKICAgICAgICAgICAgICAgICAgICBsYXN0X25hbWUgPSB1c2VyLmxhc3RfbmFtZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsYXN0X25hbWUgPSAiIgogICAgICAgICAgICAgICAgbmFtZSA9IChmaXJzdF9uYW1lICsgJyAnICsgbGFzdF9uYW1lKS5zdHJpcCgpCiAgICAgICAgICAgICAgICB3cml0ZXIud3JpdGVyb3coW3VzZXJuYW1lLCB1c2VyLmlkLCB1c2VyLmFjY2Vzc19oYXNoLCBuYW1lLCB0YXJnZXRfZ3JvdXAudGl0bGUsIHRhcmdldF9ncm91cC5pZF0pCiAgICAgICAgcHJpbnQoZidNZW1iZXJzIHNjcmFwZWQgc3VjY2Vzc2Z1bGx5LntsZ30nKQogICAgICAgIFNMRUVQX1RJTUVfMiA9IDE4MDAKICAgICAgICBTTEVFUF9USU1FXzEgPSA0MDAKICAgICAgICBTTEVFUF9USU1FID0gaW50KGlucHV0KGYiRW50ZXIgc2xlZXAgdGltZSBkdXJhdGlvbiBpbiBtZXNzYWdlcyA6e2xnfSIpKQogICAgICAgIHVzZXJzID0gW10KICAgICAgICB3aXRoIG9wZW4ociJtZW1iZXJzLmNzdiIsIGVuY29kaW5nPSdVVEYtOCcpIGFzIGY6CiAgICAgICAgICAgIHJvd3MgPSBjc3YucmVhZGVyKGYsZGVsaW1pdGVyPSIsIixsaW5ldGVybWluYXRvcj0iXG4iKQogICAgICAgICAgICBuZXh0KHJvd3MsIE5vbmUpCiAgICAgICAgICAgIGZvciByb3cgaW4gcm93czoKICAgICAgICAgICAgICAgIHVzZXIgPSB7fQogICAgICAgICAgICAgICAgdXNlclsndXNlcm5hbWUnXSA9IHJvd1swXQogICAgICAgICAgICAgICAgdXNlclsnaWQnXSA9IGludChyb3dbMV0pCiAgICAgICAgICAgICAgICB1c2VyWydhY2Nlc3NfaGFzaCddID0gaW50KHJvd1syXSkKICAgICAgICAgICAgICAgIHVzZXJbJ25hbWUnXSA9IHJvd1szXQogICAgICAgICAgICAgICAgdXNlcnMuYXBwZW5kKHVzZXIpCiAgICAgICAgbW9kZSA9IGludChpbnB1dChmIkVudGVyIDEgdG8gc2VuZCBieSB1c2VyIElEIG9yIDIgdG8gc2VuZCBieSB1c2VybmFtZTp7bGd9IikpCiAgICAgICAgbWVzc2FnZSA9IHN0cihpbnB1dChmInNlbmQgeW91ciBtZXNzc2FnZXtsZ30iKSkgIAogICAgICAgIGZvciB1c2VyIGluIHVzZXJzOgogICAgICAgICAgICBpZiBtb2RlID09IDI6CiAgICAgICAgICAgICAgICBpZiB1c2VyWyd1c2VybmFtZSddID09ICIiOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICByZWNlaXZlciA9IGNsbnQuZ2V0X2lucHV0X2VudGl0eSh1c2VyWyd1c2VybmFtZSddKQogICAgICAgICAgICBlbGlmIG1vZGUgPT0gMToKICAgICAgICAgICAgICAgIHJlY2VpdmVyID0gSW5wdXRQZWVyVXNlcih1c2VyWydpZCddLHVzZXJbJ2FjY2Vzc19oYXNoJ10pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIkludmFsaWQgTW9kZS4gRXhpdGluZy57bGd9IikKICAgICAgICAgICAgICAgIGNsbnQuZGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICBzeXMuZXhpdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHByaW50KGYiU2VuZGluZyBNZXNzYWdlIHRvOntsZ30iLCB1c2VyWyduYW1lJ10pCiAgICAgICAgICAgICAgICBjbG50LnNlbmRfbWVzc2FnZShyZWNlaXZlciwgbWVzc2FnZS5mb3JtYXQodXNlclsnbmFtZSddKSkKICAgICAgICAgICAgICAgIHByaW50KCJXYWl0aW5nIHt9IHNlY29uZHN7bGd9Ii5mb3JtYXQoU0xFRVBfVElNRSkpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKFNMRUVQX1RJTUUpCiAgICAgICAgICAgIGV4Y2VwdCBQZWVyRmxvb2RFcnJvcjoKICAgICAgICAgICAgICAgIHByaW50KCJHZXR0aW5nIEZsb29kIEVycm9yIGZyb20gdGVsZWdyYW0uIFNjcmlwdCBpcyBzdG9wcGluZyBub3cuIFBsZWFzZSB0cnkgYWdhaW4gYWZ0ZXIgc29tZSB0aW1lLiIpCiAgICAgICAgICAgICAgICBwcmludCgiV2FpdGluZyB7fSBzZWNvbmRzIi5mb3JtYXQoU0xFRVBfVElNRV8yKSkKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoU0xFRVBfVElNRV8yKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludCgiRXJyb3I6IiwgZSkKICAgICAgICAgICAgICAgIHByaW50KCJUcnlpbmcgdG8gY29udGludWUuLi4iKQogICAgICAgICAgICAgICAgcHJpbnQoIldhaXRpbmcge30gc2Vjb25kcyIuZm9ybWF0KFNMRUVQX1RJTUVfMSkpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKFNMRUVQX1RJTUVfMSkKICAgICAgICBjbG50LmRpc2Nvbm5lY3QoKQogICAgICAgIHByaW50KGYiRG9uZS4gTWVzc2FnZSBzZW50IHRvIGFsbCB1c2Vycy57bGd9IikgCiAgICAgICAgaW5wdXQoZidcbiBQcmVzcyBlbnRlciB0byBnb3RvIG1haW4gbWVudS4uLicpCiAgICAgIAogICAgZWxpZiBhID09IDc6CiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIGYgPSBvcGVuKCd2YXJzLnR4dCcsICdyYicpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKHBpY2tsZS5sb2FkKGYpKQogICAgICAgICAgICBleGNlcHQgRU9GRXJyb3I6CiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAKICAgICAgICAjcHJpbnQoJ1xuJyArIGluZm8gKyBsZyArICcgQ2hlY2tpbmcgZm9yIGJhbm5lZCBhY2NvdW50cy4uLicgKyBycykKICAgICAgICBwcmludCgnXG4nICcgQ2hlY2tpbmcgZm9yIGJhbm5lZCBhY2NvdW50cy4uLicgKQogICAgICAgIGZvciBhIGluIGFjY291bnRzOgogICAgICAgICAgICBwaG4gPSBhWzBdCiAgICAgICAgICAgIHByaW50KGYnQ2hlY2tpbmcge2xnfXtwaG59JykKICAgICAgICAgICAgY2xudCA9IFRlbGVncmFtQ2xpZW50KGYnc2Vzc2lvbnMve3Bobn0nLCA4MDI3MTk2ICwgJzliNzBiMjBlZmQ2N2U5Yjk5ZWRjMzk1ZDc4NDA3Y2ZhJykKICAgICAgICAgICAgY2xudC5jb25uZWN0KCkKICAgICAgICAgICAgYmFubmVkID0gW10KICAgICAgICAgICAgaWYgbm90IGNsbnQuaXNfdXNlcl9hdXRob3JpemVkKCk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY2xudC5zZW5kX2NvZGVfcmVxdWVzdChwaG4pCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoJ2trJykKICAgICAgICAgICAgICAgIGV4Y2VwdCBQaG9uZU51bWJlckJhbm5lZEVycm9yOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYne2Vycm9yfSB7d317cGhufSB7cn1pcyBiYW5uZWQhe3JzfScpCiAgICAgICAgICAgICAgICAgICAgYmFubmVkLmFwcGVuZChhKQogICAgICAgICAgICBmb3IgeiBpbiBiYW5uZWQ6CiAgICAgICAgICAgICAgICBhY2NvdW50cy5yZW1vdmUoeikKICAgICAgICAgICAgICAgIHByaW50KCd7bGd9QmFubmVkIGFjY291bnQgcmVtb3ZlZFtSZW1vdmUgcGVybWFuZW50bHkgdXNpbmcgbWFuYWdlci5weV17cnN9JykKICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgIGNsbnQuZGlzY29ubmVjdCgpCiAgICAgICAgcHJpbnQoJyBTZXNzaW9ucyBjcmVhdGVkIScpCiAgICAgICAgY2xyKCkKICAgICAgICBiYW5uZXIoKQogICAgICAgIGFjY291bnRzID0gW10KICAgICAgICBmID0gb3BlbigndmFycy50eHQnLCAncmInKQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFjY291bnRzLmFwcGVuZChwaWNrbGUubG9hZChmKSkKICAgICAgICAgICAgZXhjZXB0IEVPRkVycm9yOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBwcmludChmJ3tsZ30gVG90YWwgYWNjb3VudHM6IHt3fXtsZW4oYWNjb3VudHMpfScpCiAgICAgICAgbnVtYmVyX29mX2FjY3MgPSBpbnQoaW5wdXQoZid7Y3l9IEVudGVyIG51bWJlciBvZiBhY2NvdW5zIHRvIGNoYW5nZSBQaWMge3J9JykpCiAgICAgICAgdG9fdXNlID0gW3ggZm9yIHggaW4gYWNjb3VudHNbOm51bWJlcl9vZl9hY2NzXV0KICAgICAgICBmb3IgbCBpbiB0b191c2U6IGFjY291bnRzLnJlbW92ZShsKQogICAgICAgIHdpdGggb3BlbigndmFycy50eHQnLCAnd2InKSBhcyBmOgogICAgICAgICAgICBmb3IgYSBpbiBhY2NvdW50czoKICAgICAgICAgICAgICAgIHBpY2tsZS5kdW1wKGEsIGYpCiAgICAgICAgICAgIGZvciBhYiBpbiB0b191c2U6CiAgICAgICAgICAgICAgICBwaWNrbGUuZHVtcChhYiwgZikKICAgICAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgc2xlZXBfdGltZSA9IDEKICAgICAgICBwcmludChmJ3tsZ30gLS1Qcm9maWUgU2V0IFN1Y2VzZnVsbHl7d317bGVuKHRvX3VzZSl9e2xnfSBhY2NvdW50IC0tJykgICAKICAgICAgICBzZW5kX3N0YXR1cyA9IDAKICAgICAgICAKICAgICAgICBhcHByb3hfbWVtYmVyc19jb3VudCA9IDAKICAgICAgICBpbmRleCA9IDAKICAgICAgICBmb3IgYWNjIGluIHRvX3VzZToKICAgICAgICAgICAgc3RvcCA9IGluZGV4ICsgNjAKICAgICAgICAgICAgYyA9IFRlbGVncmFtQ2xpZW50KGYnc2Vzc2lvbnMve2FjY1swXX0nLCAzOTEwMzg5ICwgJzg2Zjg2MTM1MmYwYWI3NmEyNTE4NjYwNTlhNmFkYmQ2JykKICAgICAgICAgICAgcHJpbnQoZidVc2VyOiB7Y3l9e2FjY1swXX17bGd9IC0tIHtjeX1TdGFydGluZyBzZXNzaW9uLi4uICcpCiAgICAgICAgICAgIGMuc3RhcnQoYWNjWzBdKQogICAgICAgICAgICBhY2NfbmFtZSA9IGMuZ2V0X21lKCkuZmlyc3RfbmFtZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjKFVwbG9hZFByb2ZpbGVQaG90b1JlcXVlc3QoYy51cGxvYWRfZmlsZSgnYmVhc3QuanBnJykpKQogICAgICAgICAgICAgICAgcHJpbnQoZidQcm9maWxlIFNldCBTdWNlc2Z1bGx5IFRvOiB7Y3l9e2FjY19uYW1lfXtsZ30gIFQtLSAnKQogICAgICAgICAgICAgICAgc2VuZF9zdGF0dXMgKz0gMQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBwcmludChmJ3tlfScpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgIGlmIHNlbmRfc3RhdHVzICE9IDA6CiAgICAgICAgICAgIHByaW50KGYiXG57bGd9c2Vzc2lvbiBlbmRlZCIpCiAgICAgICAgICAgIGlucHV0KGYnXG57Y3l9IFByZXNzIGVudGVyIHRvIGV4aXQuLi4nKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYiXG57bGd9IGFsbCBwcm9maWxlIHNldHVwcGVkIHN1Y2Nlc2Z1bGx5IikKICAgICAgICAgICAgaW5wdXQoZidcbntjeX0gUHJlc3MgZW50ZXIgdG8gZXhpdC4uLicpCiAgICAgICAKICAgIGVsaWYgYSA9PSA4OgogICAgICAgIGFjY291bnRzID0gW10KICAgICAgICBmID0gb3BlbigndmFycy50eHQnLCAncmInKQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFjY291bnRzLmFwcGVuZChwaWNrbGUubG9hZChmKSkKICAgICAgICAgICAgZXhjZXB0IEVPRkVycm9yOgogICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgCiAgICAgICAgI3ByaW50KCdcbicgKyBpbmZvICsgbGcgKyAnIENoZWNraW5nIGZvciBiYW5uZWQgYWNjb3VudHMuLi4nICsgcnMpCiAgICAgICAgcHJpbnQoJ1xuJyAnIENoZWNraW5nIGZvciBiYW5uZWQgYWNjb3VudHMuLi4nICkKICAgICAgICBmb3IgYSBpbiBhY2NvdW50czoKICAgICAgICAgICAgcGhuID0gYVswXQogICAgICAgICAgICBwcmludChmJ0NoZWNraW5nIHtsZ317cGhufScpCiAgICAgICAgICAgIGNsbnQgPSBUZWxlZ3JhbUNsaWVudChmJ3Nlc3Npb25zL3twaG59JywgODAyNzE5NiAsICc5YjcwYjIwZWZkNjdlOWI5OWVkYzM5NWQ3ODQwN2NmYScpCiAgICAgICAgICAgIGNsbnQuY29ubmVjdCgpCiAgICAgICAgICAgIGJhbm5lZCA9IFtdCiAgICAgICAgICAgIGlmIG5vdCBjbG50LmlzX3VzZXJfYXV0aG9yaXplZCgpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNsbnQuc2VuZF9jb2RlX3JlcXVlc3QocGhuKQogICAgICAgICAgICAgICAgICAgIHByaW50KCdraycpCiAgICAgICAgICAgICAgICBleGNlcHQgUGhvbmVOdW1iZXJCYW5uZWRFcnJvcjoKICAgICAgICAgICAgICAgICAgICBwcmludChmJ3tlcnJvcn0ge3d9e3Bobn0ge3J9aXMgYmFubmVkIXtyc30nKQogICAgICAgICAgICAgICAgICAgIGJhbm5lZC5hcHBlbmQoYSkKICAgICAgICAgICAgZm9yIHogaW4gYmFubmVkOgogICAgICAgICAgICAgICAgYWNjb3VudHMucmVtb3ZlKHopCiAgICAgICAgICAgICAgICBwcmludCgne2xnfUJhbm5lZCBhY2NvdW50IHJlbW92ZWRbUmVtb3ZlIHBlcm1hbmVudGx5IHVzaW5nIG1hbmFnZXIucHlde3JzfScpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMC41KQogICAgICAgICAgICBjbG50LmRpc2Nvbm5lY3QoKQogICAgICAgIHByaW50KCcgU2Vzc2lvbnMgY3JlYXRlZCEnKQogICAgICAgIGNscigpCiAgICAgICAgYmFubmVyKCkKICAgICAgICBhY2NvdW50cyA9IFtdCiAgICAgICAgZiA9IG9wZW4oJ3ZhcnMudHh0JywgJ3JiJykKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhY2NvdW50cy5hcHBlbmQocGlja2xlLmxvYWQoZikpCiAgICAgICAgICAgIGV4Y2VwdCBFT0ZFcnJvcjoKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgcHJpbnQoZid7bGd9IFRvdGFsIGFjY291bnRzOiB7d317bGVuKGFjY291bnRzKX0nKQogICAgICAgIG51bWJlcl9vZl9hY2NzID0gaW50KGlucHV0KGYne2N5fSBFbnRlciBudW1iZXIgb2YgYWNjb3VudHMgdG8gcmVwb3J0IHNwYW0gIHtyfScpKQogICAgICAgIHVzZXIgPSBzdHIoaW5wdXQoZid7Y3l9IEVudGVyIEdyb3VwLENoYW5uZWwgb3IgdXNlciB1c2VybmFtZXtyfScpKQogICAgICAgIHRvX3VzZSA9IFt4IGZvciB4IGluIGFjY291bnRzWzpudW1iZXJfb2ZfYWNjc11dCiAgICAgICAgZm9yIGwgaW4gdG9fdXNlOiBhY2NvdW50cy5yZW1vdmUobCkKICAgICAgICB3aXRoIG9wZW4oJ3ZhcnMudHh0JywgJ3diJykgYXMgZjoKICAgICAgICAgICAgZm9yIGEgaW4gYWNjb3VudHM6CiAgICAgICAgICAgICAgICBwaWNrbGUuZHVtcChhLCBmKQogICAgICAgICAgICBmb3IgYWIgaW4gdG9fdXNlOgogICAgICAgICAgICAgICAgcGlja2xlLmR1bXAoYWIsIGYpCiAgICAgICAgICAgIGYuY2xvc2UoKQogICAgICAgIHNsZWVwX3RpbWUgPSAxCiAgICAgICAgcHJpbnQoZid7bGd9IC0tUmVwb3J0IFNwYW0gU3RhcnRlZCBTdWNlc2Z1bGx5e3VzZXJ9e2xnfSBhY2NvdW50IC0tJykgICAKICAgICAgICBzZW5kX3N0YXR1cyA9IDAKICAgICAgICAKICAgICAgICBhcHByb3hfbWVtYmVyc19jb3VudCA9IDAKICAgICAgICBpbmRleCA9IDAKICAgICAgICBmb3IgYWNjIGluIHRvX3VzZToKICAgICAgICAgICAgc3RvcCA9IGluZGV4ICsgNjAKICAgICAgICAgICAgYyA9IFRlbGVncmFtQ2xpZW50KGYnc2Vzc2lvbnMve2FjY1swXX0nLCAzOTEwMzg5ICwgJzg2Zjg2MTM1MmYwYWI3NmEyNTE4NjYwNTlhNmFkYmQ2JykKICAgICAgICAgICAgcHJpbnQoZidVc2VyOiB7Y3l9e2FjY1swXX17bGd9IC0tIHtjeX1TdGFydGluZyBzZXNzaW9uLi4uICcpCiAgICAgICAgICAgIGMuc3RhcnQoYWNjWzBdKQogICAgICAgICAgICBhY2NfbmFtZSA9IGMuZ2V0X21lKCkuZmlyc3RfbmFtZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjKFJlcG9ydFNwYW1SZXF1ZXN0KHVzZXIpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwcmludChmJz09PT09PT1SZXBvcnRlZCBzcGFtIHt1c2VyfTpmcm9tIHtjeX17YWNjX25hbWV9e2xnfT09PT09PT09ICcpCiAgICAgICAgICAgICAgICBzZW5kX3N0YXR1cyArPSAxCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYne2V9JykKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgaWYgc2VuZF9zdGF0dXMgIT0gMDoKICAgICAgICAgICAgcHJpbnQoZiJcbntsZ31zZXNzaW9uIGVuZGVkIikKICAgICAgICAgICAgaW5wdXQoZidcbntjeX0gUHJlc3MgZW50ZXIgdG8gZXhpdC4uLicpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJcbntsZ30gYWxsIHJlcG9ydHMgZG9uZSBzdWNlc3NmeWxseSIpCiAgICAgICAgICAgIGlucHV0KGYnXG57Y3l9IFByZXNzIGVudGVyIHRvIGV4aXQuLi4nKQogICAgICAgIAogICAgZWxpZiBhID09IDk6CiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIGYgPSBvcGVuKCd2YXJzLnR4dCcsICdyYicpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKHBpY2tsZS5sb2FkKGYpKQogICAgICAgICAgICBleGNlcHQgRU9GRXJyb3I6CiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAKICAgICAgICAjcHJpbnQoJ1xuJyArIGluZm8gKyBsZyArICcgQ2hlY2tpbmcgZm9yIGJhbm5lZCBhY2NvdW50cy4uLicgKyBycykKICAgICAgICBwcmludCgnXG4nICcgQ2hlY2tpbmcgZm9yIGJhbm5lZCBhY2NvdW50cy4uLicgKQogICAgICAgIGZvciBhIGluIGFjY291bnRzOgogICAgICAgICAgICBwaG4gPSBhWzBdCiAgICAgICAgICAgIHByaW50KGYnQ2hlY2tpbmcge2xnfXtwaG59JykKICAgICAgICAgICAgY2xudCA9IFRlbGVncmFtQ2xpZW50KGYnc2Vzc2lvbnMve3Bobn0nLCA4MDI3MTk2ICwgJzliNzBiMjBlZmQ2N2U5Yjk5ZWRjMzk1ZDc4NDA3Y2ZhJykKICAgICAgICAgICAgY2xudC5jb25uZWN0KCkKICAgICAgICAgICAgYmFubmVkID0gW10KICAgICAgICAgICAgaWYgbm90IGNsbnQuaXNfdXNlcl9hdXRob3JpemVkKCk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY2xudC5zZW5kX2NvZGVfcmVxdWVzdChwaG4pCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoJ2trJykKICAgICAgICAgICAgICAgIGV4Y2VwdCBQaG9uZU51bWJlckJhbm5lZEVycm9yOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYne2Vycm9yfSB7d317cGhufSB7cn1pcyBiYW5uZWQhe3JzfScpCiAgICAgICAgICAgICAgICAgICAgYmFubmVkLmFwcGVuZChhKQogICAgICAgICAgICBmb3IgeiBpbiBiYW5uZWQ6CiAgICAgICAgICAgICAgICBhY2NvdW50cy5yZW1vdmUoeikKICAgICAgICAgICAgICAgIHByaW50KCd7bGd9QmFubmVkIGFjY291bnQgcmVtb3ZlZFtSZW1vdmUgcGVybWFuZW50bHkgdXNpbmcgbWFuYWdlci5weV17cnN9JykKICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgIGNsbnQuZGlzY29ubmVjdCgpCiAgICAgICAgcHJpbnQoJyBTZXNzaW9ucyBjcmVhdGVkIScpCiAgICAgICAgY2xyKCkKICAgICAgICBiYW5uZXIoKQogICAgICAgIGFjY291bnRzID0gW10KICAgICAgICBmID0gb3BlbigndmFycy50eHQnLCAncmInKQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFjY291bnRzLmFwcGVuZChwaWNrbGUubG9hZChmKSkKICAgICAgICAgICAgZXhjZXB0IEVPRkVycm9yOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBwcmludChmJ3tsZ30gVG90YWwgYWNjb3VudHM6IHt3fXtsZW4oYWNjb3VudHMpfScpCiAgICAgICAgbnVtYmVyX29mX2FjY3MgPSBpbnQoaW5wdXQoZid7Y3l9IEVudGVyIG51bWJlciBvZiBhY2NvdW50cyBUbyBzZW5kIERtIHtyfScpKQogICAgICAgIHVzZSA9IHN0cihpbnB1dChmJ3tjeX0gRW50ZXIgdXNlcm5hbWUgb2YgYSB1c2VyIHRvIHNlbmQgZG0gaGltL2hlcntyfScpKQogICAgICAgIG1zZ190b3BpID0gc3RyKGlucHV0KGYne2N5fSBOb3cgZW50ZXIgTWVzc2FnZSB0byBzZW5kIGhpbXtyfScpKQogICAgICAgIHRvX3VzZSA9IFt4IGZvciB4IGluIGFjY291bnRzWzpudW1iZXJfb2ZfYWNjc11dCiAgICAgICAgZm9yIGwgaW4gdG9fdXNlOiBhY2NvdW50cy5yZW1vdmUobCkKICAgICAgICB3aXRoIG9wZW4oJ3ZhcnMudHh0JywgJ3diJykgYXMgZjoKICAgICAgICAgICAgZm9yIGEgaW4gYWNjb3VudHM6CiAgICAgICAgICAgICAgICBwaWNrbGUuZHVtcChhLCBmKQogICAgICAgICAgICBmb3IgYWIgaW4gdG9fdXNlOgogICAgICAgICAgICAgICAgcGlja2xlLmR1bXAoYWIsIGYpCiAgICAgICAgICAgIGYuY2xvc2UoKQogICAgICAgIHNsZWVwX3RpbWUgPSAxCiAgICAgICAgcHJpbnQoZid7bGd9IC0tU2VuZGluZyBEbSB0byB7dXNlfXtsZ30uLi4uLiAtLScpICAgCiAgICAgICAgc2VuZF9zdGF0dXMgPSAwCiAgICAgICAgCiAgICAgICAgYXBwcm94X21lbWJlcnNfY291bnQgPSAwCiAgICAgICAgaW5kZXggPSAwCiAgICAgICAgZm9yIGFjYyBpbiB0b191c2U6CiAgICAgICAgICAgIHN0b3AgPSBpbmRleCArIDYwCiAgICAgICAgICAgIGMgPSBUZWxlZ3JhbUNsaWVudChmJ3Nlc3Npb25zL3thY2NbMF19JywgMzkxMDM4OSAsICc4NmY4NjEzNTJmMGFiNzZhMjUxODY2MDU5YTZhZGJkNicpCiAgICAgICAgICAgIHByaW50KGYnVXNlcjoge2N5fXthY2NbMF19e2xnfSAtLSB7Y3l9U3RhcnRpbmcgc2Vzc2lvbi4uLiAnKQogICAgICAgICAgICBjLnN0YXJ0KGFjY1swXSkKICAgICAgICAgICAgYWNjX25hbWUgPSBjLmdldF9tZSgpLmZpcnN0X25hbWUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYy5zZW5kX21lc3NhZ2UodXNlLG1zZ190b3BpKQogICAgICAgICAgICAgICAgcHJpbnQoZic9PT09PT09RG0gc2VudCB7dXNlfTpmcm9tIHtjeX17YWNjX25hbWV9e2xnfT09PT09PT09ICcpCiAgICAgICAgICAgICAgICBzZW5kX3N0YXR1cyArPSAxCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYne2V9JykKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgaWYgc2VuZF9zdGF0dXMgIT0gMDoKICAgICAgICAgICAgcHJpbnQoZiJcbntsZ31zZXNzaW9uIGVuZGVkIikKICAgICAgICAgICAgaW5wdXQoZidcbntjeX0gUHJlc3MgZW50ZXIgdG8gZXhpdC4uLicpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJcbntsZ30gQWxsIERtIGRvbmUgc3VjZXNzZnlsbHkiKQogICAgICAgICAgICBpbnB1dChmJ1xue2N5fSBQcmVzcyBlbnRlciB0byBleGl0Li4uJykKCiAgICBlbGlmIGEgPT0gMTE6CiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIGYgPSBvcGVuKCd2YXJzLnR4dCcsICdyYicpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKHBpY2tsZS5sb2FkKGYpKQogICAgICAgICAgICBleGNlcHQgRU9GRXJyb3I6CiAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAKICAgICAgICAjcHJpbnQoJ1xuJyArIGluZm8gKyBsZyArICcgQ2hlY2tpbmcgZm9yIGJhbm5lZCBhY2NvdW50cy4uLicgKyBycykKICAgICAgICBwcmludCgnXG4nICcgQ2hlY2tpbmcgZm9yIGJhbm5lZCBhY2NvdW50cy4uLicgKQogICAgICAgIGZvciBhIGluIGFjY291bnRzOgogICAgICAgICAgICBwaG4gPSBhWzBdCiAgICAgICAgICAgIHByaW50KGYnQ2hlY2tpbmcge2xnfXtwaG59JykKICAgICAgICAgICAgY2xudCA9IFRlbGVncmFtQ2xpZW50KGYnc2Vzc2lvbnMve3Bobn0nLCA4MDI3MTk2ICwgJzliNzBiMjBlZmQ2N2U5Yjk5ZWRjMzk1ZDc4NDA3Y2ZhJykKICAgICAgICAgICAgY2xudC5jb25uZWN0KCkKICAgICAgICAgICAgYmFubmVkID0gW10KICAgICAgICAgICAgaWYgbm90IGNsbnQuaXNfdXNlcl9hdXRob3JpemVkKCk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY2xudC5zZW5kX2NvZGVfcmVxdWVzdChwaG4pCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoJ2trJykKICAgICAgICAgICAgICAgIGV4Y2VwdCBQaG9uZU51bWJlckJhbm5lZEVycm9yOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYne2Vycm9yfSB7d317cGhufSB7cn1pcyBiYW5uZWQhe3JzfScpCiAgICAgICAgICAgICAgICAgICAgYmFubmVkLmFwcGVuZChhKQogICAgICAgICAgICBmb3IgeiBpbiBiYW5uZWQ6CiAgICAgICAgICAgICAgICBhY2NvdW50cy5yZW1vdmUoeikKICAgICAgICAgICAgICAgIHByaW50KCd7bGd9QmFubmVkIGFjY291bnQgcmVtb3ZlZFtSZW1vdmUgcGVybWFuZW50bHkgdXNpbmcgbWFuYWdlci5weV17cnN9JykKICAgICAgICAgICAgdGltZS5zbGVlcCgwLjUpCiAgICAgICAgICAgIGNsbnQuZGlzY29ubmVjdCgpCiAgICAgICAgcHJpbnQoJyBTZXNzaW9ucyBjcmVhdGVkIScpCiAgICAgICAgY2xyKCkKICAgICAgICBiYW5uZXIoKQogICAgICAgIGFjY291bnRzID0gW10KICAgICAgICBmID0gb3BlbigndmFycy50eHQnLCAncmInKQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFjY291bnRzLmFwcGVuZChwaWNrbGUubG9hZChmKSkKICAgICAgICAgICAgZXhjZXB0IEVPRkVycm9yOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBwcmludChmJ3tsZ30gVG90YWwgYWNjb3VudHM6IHt3fXtsZW4oYWNjb3VudHMpfScpCiAgICAgICAgbnVtYmVyX29mX2FjY3MgPSBpbnQoaW5wdXQoZid7Y3l9IEVudGVyciBudW1iZXIgYWNjb3V0IHRvIGpvaW4gY2hhbm5lbCBvciBncm91cCB7cn0nKSkKICAgICAgICBqb2luX29wID0gc3RyKGlucHV0KGYne2N5fSBzZW5kIGNoYW5uZWwvZ3JvdXAgdXNlcm5hbWUge3J9JykpCiAgICAgICAgdG9fdXNlID0gW3ggZm9yIHggaW4gYWNjb3VudHNbOm51bWJlcl9vZl9hY2NzXV0KICAgICAgICBmb3IgbCBpbiB0b191c2U6IGFjY291bnRzLnJlbW92ZShsKQogICAgICAgIHdpdGggb3BlbigndmFycy50eHQnLCAnd2InKSBhcyBmOgogICAgICAgICAgICBmb3IgYSBpbiBhY2NvdW50czoKICAgICAgICAgICAgICAgIHBpY2tsZS5kdW1wKGEsIGYpCiAgICAgICAgICAgIGZvciBhYiBpbiB0b191c2U6CiAgICAgICAgICAgICAgICBwaWNrbGUuZHVtcChhYiwgZikKICAgICAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgc2xlZXBfdGltZSA9IDEKICAgICAgICBwcmludChmJ3tsZ30gLS1qb2luaW5nIGNoYW5uZWxzLS0nKSAgIAogICAgICAgIHNlbmRfc3RhdHVzID0gMAogICAgICAgIAogICAgICAgIGFwcHJveF9tZW1iZXJzX2NvdW50ID0gMAogICAgICAgIGluZGV4ID0gMAogICAgICAgIGZvciBhY2MgaW4gdG9fdXNlOgogICAgICAgICAgICBzdG9wID0gaW5kZXggKyA2MAogICAgICAgICAgICBjID0gVGVsZWdyYW1DbGllbnQoZidzZXNzaW9ucy97YWNjWzBdfScsIDM5MTAzODkgLCAnODZmODYxMzUyZjBhYjc2YTI1MTg2NjA1OWE2YWRiZDYnKQogICAgICAgICAgICBwcmludChmJ1VzZXI6IHtjeX17YWNjWzBdfXtsZ30gLS0ge2N5fVN0YXJ0aW5nIHNlc3Npb24uLi4gJykKICAgICAgICAgICAgYy5zdGFydChhY2NbMF0pCiAgICAgICAgICAgIGFjY19uYW1lID0gYy5nZXRfbWUoKS5maXJzdF9uYW1lCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGMoSm9pbkNoYW5uZWxSZXF1ZXN0KGpvaW5fb3ApKQogICAgICAgICAgICAgICAgcHJpbnQoZidqb2luZWQgZnJvbToge2N5fXthY2NfbmFtZX17bGd9ICBTdWNlc2Z1bGx5LS0gJykKICAgICAgICAgICAgICAgIHNlbmRfc3RhdHVzICs9IDEKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoZid7ZX0nKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBpZiBzZW5kX3N0YXR1cyAhPSAwOgogICAgICAgICAgICBwcmludChmIlxue2xnfXNlc3Npb24gZW5kZWQiKQogICAgICAgICAgICBpbnB1dChmJ1xue2N5fSBQcmVzcyBlbnRlciB0byBleGl0Li4uJykKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIlxue2xnfSBKb2luZWQgc3VjY2VzZnVsbHkiKQogICAgICAgICAgICBpbnB1dChmJ1xue2N5fSBQcmVzcyBlbnRlciB0byBleGl0Li4uJykKICAgICAgICAKICAgIGVsaWYgYSA9PSAxMjoKICAgICAgICBhY2NvdW50cyA9IFtdCiAgICAgICAgZiA9IG9wZW4oJ3ZhcnMudHh0JywgJ3JiJykKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhY2NvdW50cy5hcHBlbmQocGlja2xlLmxvYWQoZikpCiAgICAgICAgICAgIGV4Y2VwdCBFT0ZFcnJvcjoKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIAogICAgICAgICNwcmludCgnXG4nICsgaW5mbyArIGxnICsgJyBDaGVja2luZyBmb3IgYmFubmVkIGFjY291bnRzLi4uJyArIHJzKQogICAgICAgIHByaW50KCdcbicgJyBDaGVja2luZyBmb3IgYmFubmVkIGFjY291bnRzLi4uJyApCiAgICAgICAgZm9yIGEgaW4gYWNjb3VudHM6CiAgICAgICAgICAgIHBobiA9IGFbMF0KICAgICAgICAgICAgcHJpbnQoZidDaGVja2luZyB7bGd9e3Bobn0nKQogICAgICAgICAgICBjbG50ID0gVGVsZWdyYW1DbGllbnQoZidzZXNzaW9ucy97cGhufScsIDgwMjcxOTYgLCAnOWI3MGIyMGVmZDY3ZTliOTllZGMzOTVkNzg0MDdjZmEnKQogICAgICAgICAgICBjbG50LmNvbm5lY3QoKQogICAgICAgICAgICBiYW5uZWQgPSBbXQogICAgICAgICAgICBpZiBub3QgY2xudC5pc191c2VyX2F1dGhvcml6ZWQoKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjbG50LnNlbmRfY29kZV9yZXF1ZXN0KHBobikKICAgICAgICAgICAgICAgICAgICBwcmludCgna2snKQogICAgICAgICAgICAgICAgZXhjZXB0IFBob25lTnVtYmVyQmFubmVkRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZid7ZXJyb3J9IHt3fXtwaG59IHtyfWlzIGJhbm5lZCF7cnN9JykKICAgICAgICAgICAgICAgICAgICBiYW5uZWQuYXBwZW5kKGEpCiAgICAgICAgICAgIGZvciB6IGluIGJhbm5lZDoKICAgICAgICAgICAgICAgIGFjY291bnRzLnJlbW92ZSh6KQogICAgICAgICAgICAgICAgcHJpbnQoJ3tsZ31CYW5uZWQgYWNjb3VudCByZW1vdmVkW1JlbW92ZSBwZXJtYW5lbnRseSB1c2luZyBtYW5hZ2VyLnB5XXtyc30nKQogICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkKICAgICAgICAgICAgY2xudC5kaXNjb25uZWN0KCkKICAgICAgICBwcmludCgnIFNlc3Npb25zIGNyZWF0ZWQhJykKICAgICAgICBjbHIoKQogICAgICAgIGJhbm5lcigpCiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIGYgPSBvcGVuKCd2YXJzLnR4dCcsICdyYicpCiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKHBpY2tsZS5sb2FkKGYpKQogICAgICAgICAgICBleGNlcHQgRU9GRXJyb3I6CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIHByaW50KGYne2xnfSBUb3RhbCBhY2NvdW50czoge3d9e2xlbihhY2NvdW50cyl9JykKICAgICAgICBudW1iZXJfb2ZfYWNjcyA9IGludChpbnB1dChmJ3tjeX0gRW50ZXJyIG51bWJlciBhY2NvdXQgdG8gam9pbiBjaGFubmVsIG9yIGdyb3VwIHtyfScpKQogICAgICAgIGxlZnRfb3AgPSBzdHIoaW5wdXQoZid7Y3l9IHNlbmQgY2hhbm5lbC9ncm91cCB1c2VybmFtZSB7cn0nKSkKICAgICAgICB0b191c2UgPSBbeCBmb3IgeCBpbiBhY2NvdW50c1s6bnVtYmVyX29mX2FjY3NdXQogICAgICAgIGZvciBsIGluIHRvX3VzZTogYWNjb3VudHMucmVtb3ZlKGwpCiAgICAgICAgd2l0aCBvcGVuKCd2YXJzLnR4dCcsICd3YicpIGFzIGY6CiAgICAgICAgICAgIGZvciBhIGluIGFjY291bnRzOgogICAgICAgICAgICAgICAgcGlja2xlLmR1bXAoYSwgZikKICAgICAgICAgICAgZm9yIGFiIGluIHRvX3VzZToKICAgICAgICAgICAgICAgIHBpY2tsZS5kdW1wKGFiLCBmKQogICAgICAgICAgICBmLmNsb3NlKCkKICAgICAgICBzbGVlcF90aW1lID0gMQogICAgICAgIHByaW50KGYne2xnfSAtLUxlYXZpbmcgY2hhbm5lbHMtLScpICAgCiAgICAgICAgc2VuZF9zdGF0dXMgPSAwCiAgICAgICAgCiAgICAgICAgYXBwcm94X21lbWJlcnNfY291bnQgPSAwCiAgICAgICAgaW5kZXggPSAwCiAgICAgICAgZm9yIGFjYyBpbiB0b191c2U6CiAgICAgICAgICAgIHN0b3AgPSBpbmRleCArIDYwCiAgICAgICAgICAgIGMgPSBUZWxlZ3JhbUNsaWVudChmJ3Nlc3Npb25zL3thY2NbMF19JywgMzkxMDM4OSAsICc4NmY4NjEzNTJmMGFiNzZhMjUxODY2MDU5YTZhZGJkNicpCiAgICAgICAgICAgIHByaW50KGYnVXNlcjoge2N5fXthY2NbMF19e2xnfSAtLSB7Y3l9U3RhcnRpbmcgc2Vzc2lvbi4uLiAnKQogICAgICAgICAgICBjLnN0YXJ0KGFjY1swXSkKICAgICAgICAgICAgYWNjX25hbWUgPSBjLmdldF9tZSgpLmZpcnN0X25hbWUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYyhMZWF2ZUNoYW5uZWxSZXF1ZXN0KGxlZnRfb3ApKQogICAgICAgICAgICAgICAgcHJpbnQoZidsZWZ0IGZyb206IHtjeX17YWNjX25hbWV9e2xnfSAgU3VjZXNmdWxseS0tICcpCiAgICAgICAgICAgICAgICBzZW5kX3N0YXR1cyArPSAxCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYne2V9JykKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgaWYgc2VuZF9zdGF0dXMgIT0gMDoKICAgICAgICAgICAgcHJpbnQoZiJcbntsZ31zZXNzaW9uIGVuZGVkIikKICAgICAgICAgICAgaW5wdXQoZidcbntjeX0gUHJlc3MgZW50ZXIgdG8gZXhpdC4uLicpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJcbntsZ30gbGVmdCBzdWNjZXNmdWxseSIpCiAgICAgICAgICAgIGlucHV0KGYnXG57Y3l9IFByZXNzIGVudGVyIHRvIGV4aXQuLi4nKQoKCgogICAgZWxpZiBhID09IDEzOgogICAgICAgICMgdGhhbmtzIHRvIGdpdGh1Yi5jb20vdGgzdW5rbjBuIGZvciB0aGUgc25pcHBldCBiZWxvdwogICAgICAgIHByaW50KGYnXG57bGd9W2ldIENoZWNraW5nIGZvciB1cGRhdGVzLi4uJykKICAgICAgICB0cnk6CiAgICAgICAgICAgIHZlcnNpb24gPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9tc3kxNzE3L01lbWJlckFkZGVyL21haW4vdmVyc2lvbi50eHQnKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcHJpbnQoZid7cn0gWW91IGFyZSBub3QgY29ubmVjdGVkIHRvIHRoZSBpbnRlcm5ldCcpCiAgICAgICAgICAgIHByaW50KGYne3J9IFBsZWFzZSBjb25uZWN0IHRvIHRoZSBpbnRlcm5ldCBhbmQgcmV0cnknKQogICAgICAgICAgICBleGl0KCkKICAgICAgICBpZiBmbG9hdCh2ZXJzaW9uLnRleHQpID4gMS4xOgogICAgICAgICAgICBwcm9tcHQgPSBzdHIoaW5wdXQoZid7bGd9W35dIFVwZGF0ZSBhdmFpbGFibGVbVmVyc2lvbiB7dmVyc2lvbi50ZXh0fV0uIERvd25sb2FkP1t5L25dOiB7cn0nKSkKICAgICAgICAgICAgaWYgcHJvbXB0ID09ICd5JyBvciBwcm9tcHQgPT0gJ3llcycgb3IgcHJvbXB0ID09ICdZJzoKICAgICAgICAgICAgICAgIHByaW50KGYne2xnfVtpXSBEb3dubG9hZGluZyB1cGRhdGVzLi4uJykKICAgICAgICAgICAgICAgIGlmIG9zLm5hbWUgPT0gJ250JzoKICAgICAgICAgICAgICAgICAgICBvcy5zeXN0ZW0oJ2RlbCBtYWluLnB5JykKICAgICAgICAgICAgICAgICAgICBvcy5zeXN0ZW0oJ2RlbCBzZXR1cC5weScpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIG9zLnN5c3RlbSgncm0gbWFpbi5weScpCiAgICAgICAgICAgICAgICAgICAgb3Muc3lzdGVtKCdybSBzZXR1cC5weScpCiAgICAgICAgICAgICAgICBvcy5zeXN0ZW0oJ2N1cmwgLWwgLU8gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21zeTE3MTcvTWVtYmVyQWRkZXIvbWFpbi9tYWluLnB5JykKICAgICAgICAgICAgICAgIG9zLnN5c3RlbSgnY3VybCAtbCAtTyBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbXN5MTcxNy9NZW1iZXJBZGRlci9tYWluL3NldHVwLnB5JykKICAgICAgICAgICAgICAgIHByaW50KGYne2xnfVsqXSBVcGRhdGVkIHRvIHZlcnNpb246IHt2ZXJzaW9uLnRleHR9JykKICAgICAgICAgICAgICAgIGlucHV0KCdQcmVzcyBlbnRlciB0byBleGl0Li4uJykKICAgICAgICAgICAgICAgIGV4aXQoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZid7bGd9WyFdIFVwZGF0ZSBhYm9ydGVkLicpCiAgICAgICAgICAgICAgICBpbnB1dCgnUHJlc3MgZW50ZXIgdG8gZ290byBtYWluIG1lbnUuLi4nKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYne2xnfVtpXSBZb3VyIHNjcmlwdCBpcyBhbHJlYWR5IHVwIHRvIGRhdGUnKQogICAgICAgICAgICBpbnB1dCgnUHJlc3MgZW50ZXIgdG8gZ290byBtYWluIG1lbnUuLi4nKQoKICAgIGVsaWYgYSA9PSAwOgogICAgICAgIGNscigpCiAgICAgICAgYmFubmVyKCkKICAgICAgICBleGl0KCkK'))
